name: Test API

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.10"

    - name: Install dependencies
      run: pip install -r requirements.txt

    - name: Smoke test
      run: |
        python - << 'EOF'
        from fastapi.testclient import TestClient
        from app.main import app

        client = TestClient(app)
        r = client.get("/")
        assert r.status_code == 200
        assert "API" in r.json().get("message", "")
        EOF
